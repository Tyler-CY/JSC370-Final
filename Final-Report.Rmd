---
title: "Toronto Neighbourhood Crime"
subtitle: "Examining the relationship between Neighbourhood Crime Rate and Demographic Data in Toronto's 140 historical neighbourhoods in 2016"
date: "24 April 2022"
output:
  html_document:
    toc: TRUE
    toc_float: TRUE
always_allow_html: true
---


```{r imports, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# install.packages('opendatatoronto')
# install.packages("gt")
# install.packages("cowplot")
# install.packages('rgdal')
#install.packages('papeR')
#install.packages("flextable")
# update.packages(ask = FALSE)
# pak::pkg_install("r-lib/rlang")
# install.packages('pak')
# library(pak)

# Update rlang if error
# remove.packages('rlang')
# install.packages("rlang")

library(flextable)
library(opendatatoronto)
library(gt)
library(broom)
library(knitr)
library(ggplot2)
library(cowplot)
library(tidyverse)
library(leaflet)
library(knitr)
library(car)
library(papeR)
library(rgdal)
library(htmlwidgets)
```


# 1. Introduction

This research study aims to explore the relationship between crime rate and the characteristics of neighbourhoods in Toronto in 2016. Past studies showed that neighbourhood characteristics were significant factors of the crime rate of an area (Foster et.al 2010^[Foster, S., Giles-Corti, B., & Knuiman, M. (2010). Neighbourhood design and fear of crime: A social-ecological examination of the correlates of residents’ fear in new suburban housing developments. In Health &amp; Place (Vol. 16, Issue 6, pp. 1156–1165). Elsevier BV. https://doi.org/10.1016/j.healthplace.2010.07.007]). These characteristics include: social-economic factors such as number of businesses, number of community spaces such as parks, green spaces and community centers, ease of transit access, and human factors such as community belonging and quality of local communities (Statistics Canada 2021^[Statistics Canada. (2021). Neighbourhood characteristics and life satisfaction of individuals in lower-, middle-, and higher-income families in Canadian metropolitan areas. Government of Canada. https://doi.org/10.25318/36280001202100500006-ENG]). In this study, we aim to explore the relationship between the demographics, neighbourhood amenities and crime rate of neighbourhoods. Understanding this relationship will help the government and local communities respond more effectively against emerging crime rates, by eliminating risk factors and improving the well-being of a neighbourhood.


From 1996 to 2021, the City of Toronto was divided into 140 (historical) neighbourhoods. On 12 April 2022, Toronto's social planning neighbourhoods changed which resulted in an increase of the number of neighbourhoods to 158. This research used the historical neighbourhoods planning, since all data were collected before 2022. The sources of data used come from the following sources: [the City of Toronto's Open Data Portal](https://www.toronto.ca/city-government/data-research-maps/open-data/), [Statistics Canada](https://www.statcan.gc.ca/en/start), and several custom datasets from Kaggle[https://www.kaggle.com/]. Crime rates and police-reported crimes were collected from the first source, while Statistics Canada provided census data via Census of Population, containing information about people and housing units in Canada by their demographics, social and economic characteristics^[Government of Canada, S. C. (2020, July 17). Census of population. Surveys and statistical programs. Retrieved March 13, 2023, from https://www23.statcan.gc.ca/imdb/p2SV.pl?Function=getSurvey&amp;SDDS=3901].  


We first identified main demographics factors which were thought to be highly correlated with neighbourhood crime rates, by examining past studies of similar research: crime rates were found to be lower in neighbourhoods with higher proportions of senior citizens and immigrants, and in neighbourhoods which were further away from the urban city centers^[Statistics Canada. (n.d.). Main article. Neighbourhood Characteristics and the Distribution of Police-reported Crime in the City of Toronto. Retrieved March 13, 2023, from https://www150.statcan.gc.ca/n1/pub/85-561-m/2009018/part-partie1-eng.htm]; the proportion of visible minorities and racial heterogeneity were also found to be correlated to neighbourhood crime rates^[Sun, Ivan Y.; Triplett, Ruth A.; and Gainey, Randy R., "Neighborhood Characteristics and Crime: A Test of Sampson and Groves' Model of Social Disorganization" (2004). Sociology & Criminal Justice Faculty Publications. 3.
https://digitalcommons.odu.edu/sociology_criminaljustice_fac_pubs/3]. 

In terms of social-economic factors such as community amenities and businesses of the neighbourhood, commercial activities were found to be correlated with higher crime rate, but this relationship was mostly due to the dining businesses which opened after midnight^[Twinam, T. (2017, May 25). Danger zone: Land use and the geography of neighborhood crime. Retrieved April 25, 2023, from https://www.sciencedirect.com/science/article/abs/pii/S009411901730044X?dgcid=raven_sd_aip_email]. On the other hand, researchers discovered that short-term housing, such as Airbnb rentals, contributed to higher crime rate in the surrounding area, although the increase in crime often happened after a year or more following an increase in rental listings^[Ke, L., O’Brien, D. T., &amp; Heydari, B. (2021, July 14). Airbnb and neighborhood crime: The incursion of tourists or the erosion of local social dynamics? PLOS ONE. Retrieved April 25, 2023, from https://journals.plos.org/plosone/article?id=10.1371%2Fjournal.pone.0253315 ].

These studies provided preliminary insights for us to select the important variables and observations from thousands of features in the census data, as well as retrieving representative data from other sources.

This report outlines the process of data collection, exploratory data analysis and preliminary testing, modeling, interpreting results and findings.


# 2. Methods

## 2.1 Data Collection

To answer our research question, data were collected from The City of Toronto's Open Data Portal (the Portal), the official source for Toronto open data from city divisions and agencies^[https://open.toronto.ca/]. The datasets of interest were "Major Crime Indicators" and "Neighbourhood Profiles". Both datasets were readily available for download on Open Toronto as a CSV, JSON or XML format, or by using the Open Data Portal API. We retrieved the data by downloading the CSV file^[We originally retrieved the data through the portal's API, by installing the R package <code>opendatatoronto</code> and following the instructions in the "For Developers" section 
(See [Neighbourhood Profiles](https://open.toronto.ca/dataset/neighbourhood-profiles/) and [Major Crime Indicators](https://open.toronto.ca/dataset/major-crime-indicators/). However, the Portal updated their API and the format of the data (i.e. the column names), which rendered our old code unusable.]. The "Neighbourhoods" dataset was also retrieved as a geojson file from the Portal for creating a map visualization of crime rate: it contained the coordinates of the boundaries of the 140 historical neighbourhoods in Toronto. Lastly, two datasets were used from Kaggle, [Airbnb Toronto Data](https://www.kaggle.com/datasets/suchow32/airbnb-toronto-data) and [Toronto Neighborhoods Information](https://www.kaggle.com/datasets/youssef19/toronto-neighborhoods-inforamtion). As their names suggest, the former provide listings of Airbnb rentals in Toronto and the latter used the Foursquare API (among others) to provide additional information about Toronto neighbourhoods.

```{r data-loading, echo = F, include = F}
crimes <- read.csv('data/major-crime-indicators.csv')
profiles <- read.csv('./data/neighbourhood-profiles-2016-140-model.csv')
airbnb <- read.csv('./data/listing_toronto.csv')
venues <- read.csv('./data/Toronto_neighborhood_demographics_geographics_venues.csv')

```

### 2.1.1 Dataset - Major Crime Indicators

This dataset contains all Major Crime Indicators (MCIs) occurrences in 140 historical neighbourhoods in Toronto with reported date in between 1 January 2014 and 30 June 2022. The MCIs are divided into five categories: Assault, Break and Enter, Auto Theft, Robbery and Theft Over. The Indicators excludes the Sexual Violation offences.

The variables of interest include the MCI category (<code>mci_category</code>), the offence (<code>Offence</code>), the neighbourhood of occurrence (<code>Neighbourhood</code>), and the occurrence and reported date and time. According to the dataset description, the data is provided at the offence and/or victim level, thus one occurrence of a crime major appear several times, each associated with different MCI categories; that is, an offence could be categorized into several categories and reported multiple times in the data^[https://open.toronto.ca/dataset/major-crime-indicators/].

Table 1 in the Appendix shows the top four rows of the raw data. Descriptions of the variables can be found in the [Public Safety Data Portal: Open Data Documentation](https://torontops.maps.arcgis.com/sharing/rest/content/items/c0b17f1888544078bf650f3b8b04d35d/data), or in the "Data Cleaning" section below.


### 2.1.2 Dataset - Neighbourhood Profiles

This dataset includes census data of the 140 neighbourhoods in the City of Toronto in 2016. It contains over 2300 features of the neighbourhoods, spanning areas such as population, language, income, housing, education, and labour. There are over 2300 rows in the dataset, each representing a characteristic (feature) among the 50 topics, including marital status, income of individuals etc. Each characteristic has several sub-characteristics, for example, for the income response, there were different levels of income (\$10000-\$14999, \$15000-\$19999 etc.). Based on our findings on prior research on crime rate, these were the demographic characteristics of interest: age, level of education, employment status, immigration and citizenship status, average income tax, number of visible minorities, and population count.


The data were originally collected through the Census of Population conducted nationwide by Statistical Canada, which did not release the complete data at the level of individual neighbourhoods. However, it was aggregated by Toronto Open Data into the levels of neighbourhood and the result was summarized in this dataset. Nonetheless, a small amount of data released in the Census could not be aggregated to the levels of neighbourhoods, such as summaries of income distribution of residents in the City of Toronto as a whole. This did not deter our study as the amount of data not released at the level of neighbourhoods were significantly less than not, and the variables we chose were not any of affected variables.


Note that Statistics Canada carry out random rounding reporting practices, which may have an effect on aggregated statistics such as median, percentages and mean of groups with low number of observations^[https://open.toronto.ca/dataset/neighbourhood-profiles/].


Table 2 in the Appendix below shows the top four rows of the raw data. Descriptions of the variables can be found in the [Public Safety Data Portal: Open Data Documentation](https://torontops.maps.arcgis.com/sharing/rest/content/items/c0b17f1888544078bf650f3b8b04d35d/data), or in the "Data Cleaning" section below.


### 2.1.3 Dataset - Airbnb Toronto Data

This dataset from Kaggle contains over 16000 observations of Airbnb rental listings in Toronto on 4th November 2022. The author collected the data through the [Inside Airbnb](http://insideairbnb.com/get-the-data/) website, which provides quarterly data of Airbnb listings in cities around the world. The dataset was then cleaned by the author such that each listing was located in one of the 140 historical neighbourhoods of Toronto. The variables include the listing's owner, neighbourhood, the price, property and room type etcetera. 

Although the dataset was collected in 2022, it still provided invaluable insights of the distribution of short term rentals in the city of Toronto, assuming that each region has roughly the same changes in the number of listings over the years. Note that data from previous years were available at a price.


### 2.1.4 Dataset - Toronto Neighbourhood Information

Similar to our other data sources, the Kaggle author created this dataset in March 2021 by combining data from "Neighbourhood Profiles", "Neighbourhood Crime Rates" from Statistical Canada, and venue information from Foursquare API . The data extracted from the first two sources were heavily cleaned and preprocessed, which did not matter because we already obtained the original datasets from the official sources (as stated above). The only data we were interested in was the gym and venue information data from Foursquare API, which contained the number of gyms and points of interest in each neighbourhood.

Although this dataset was collected after 2016, it was still important to our research as the number of venues and points of interests should roughly remain the same throughout these years.


## 2.2 Data Cleaning and Wrangling

For all the datasets, we first inspected the datasets using R functions such as <code>summary</code>, <code>str</code>, <code>dim</code>, <code>head</code>, <code>is.na</code> and functions from the <code>tidyverse</code> package to group and filter the data to better understand the characteristics of the data by different groups.

### 2.2.1 Cleaning of "Major Crime Indicators"

```{r mci-data-summary, eval = F, include = F}
# Major Crime Indicators
summary(crimes)
str(crimes)
sum(is.na(crimes))

(unique(crimes$offence))

# Neighbourhood Profiles
summary(profiles)
str(profiles)
sum(is.na(profiles))
```

Unwanted variables were first removed. They included: <code>X_id</code> (unique identifier), <code>event_unique_id</code> (event identifier), <code>Division</code> (Police Division where offence occurred), <code>ucr_code</code> (UCR code for offence), <code>ucr_ext (UCR extension for offence)</code>, and <code>Hood_ID</code> (identifier of neighbourhood). 

```{r crimes-remove-var, include = F}
crimes_cleaned <- crimes
crimes_cleaned <- crimes_cleaned[ , -which(names(crimes_cleaned) %in% c('X_id', 'event_unique_id', 'Division', 'ucr_code', 'ucr_ext'))]
```

The remaining wanted variables contained information about the occurrence time and date (in variables <code>occurrencedate</code>, <code>occurrenceyear</code>, <code>occurrencemonth</code>, <code>occurrenceday</code>, <code>occurrencedayofyear</code>, <code>occurrencedayofweek</code>, <code>occurrencehour</code>), the reported time and date (in variables <code>reporteddate</code>, <code>reportedyear</code>, <code>reportedmonth</code>, <code>reportedday</code>, <code>reporteddayofyear</code>, <code>reporteddayofweek</code>, <code>reportedhour</code>), the location (in variables <code>location_type</code>, <code>premises_type</code>, <code>Neighbourhood</code>), and the crime offence (in variables <code>Offence</code> and <code>MCI</code>).

Observations not from 2016 were also removed, since we were only interested in reported offences which occurred in 2016. We also removed observations where the neighbourhood was missing, which was represented by "NSA" ("Not Specified Area") in the data.

```{r crimes-remove-obs, include = F}
crimes_cleaned <- 
  crimes_cleaned %>%
  dplyr::filter(occurrenceyear == 2016 & Neighbourhood != 'NSA')

summary(crimes_cleaned)
```

### 2.2.2 Cleaning of "Neighbourhood Profiles"

The "Neighbourhood Profiles" dataset contains characteristics (features) which have sub-characteristics (sub-features). However, these sub-characteristics are all listed under the same column (same variable) as the parent characteristic, except being indented by varying degrees based on the sub-characteristic relationships (i.e. a sub-sub-characteristic is indented more than a sub-characteristics, and so on). Moreover, some of the rows in the data are in complete wrong order, which made data cleaning inefficient and prone to error. For example, two sub-characteristics with very similar description are placed in the same indentation under the two characteristics of similar type (in the wrong order), which makes it impossible to distinguish which sub-characteristics belongs to which parent. To tackle this problem, we first identified the main characteristics wanted before cleaning the sub-characteristics.


```{r echo = F, warning=F,message=F}
crimes_by_neighbourhood <- crimes_cleaned %>%
  group_by(Neighbourhood, mci_category, Hood_ID) %>%
  dplyr::summarise(count = n()) %>%
  pivot_wider(names_from = mci_category, values_from = count) %>%
  replace(is.na(.), 0) %>%
  mutate(Total = rowSums(across(-Hood_ID), na.rm = T)) %>%
  mutate(Neighbourhood = str_replace_all(Neighbourhood, '[-/\\.]', ' ')) 

```

We first removed the "Data Source" column (which defines the data source, unrelated to our research) and divided the dataset into 50 tibbles, each representing a different topic with varying number of (sub-)characteristics. Then, we cleaned only the features (characteristics) wanted: age, level of education, employment status, immigration and citizenship status, average income tax, number of visible minorities, and population count. These features were kept in separate tables for the purpose of preliminary testing individually. Note that some of these subtables still suffered from faulty arrangements and we could only use a subset of these sub-tables in our study.


```{r profiles-divide, echo = F, include = F}
profiles_cleaned <- profiles
profiles_cleaned <- profiles_cleaned[-c(4)]
colnames(profiles_cleaned)[-c(1:5)] <- crimes_by_neighbourhood$Neighbourhood

remove_commas <- function(x) {
  as.numeric(
    gsub(',', 
         '', 
         gsub('%', '', x)
         
    )
  )
}

profiles_cleaned <- profiles_cleaned %>%
  mutate_at(c(5:145), remove_commas)

profiles_cleaned
```

```{r profiles-explore-topics, echo = F, include = F, eval = F}
topics <- profiles_cleaned %>% group_by(Topic)
profiles_by_topic <- group_split(topics)
keys <- group_keys(topics)
keys <- keys %>% map_chr(~ str_c(., collapse = ","))
keys <- strsplit(keys, split=",")
keys <- keys$Topic
```


```{r profiles-age, echo = F, include = F}
profiles_age <- profiles_cleaned %>% filter(Topic == 'Age characteristics')
profiles_age <- profiles_age[!grepl('Male|Female', profiles_age$Characteristic) , ]
profiles_age
```

```{r profiles-employment, echo = F, include = F}
employement_status <- c('Did not work', 'Worked full year, full time', 'Worked part year and/or part time')

profiles_employment <- profiles_cleaned %>% filter(Topic == 'Work activity during the reference year') %>%
  filter(str_detect(Characteristic, paste(employement_status, collapse='|')))

profiles_employment
```

```{r profiles-citizenship, echo = F, include = F}
citizenship_status <- c('Canadian citizens$')

profiles_citizenship <- profiles_cleaned %>% filter(Topic == 'Citizenship') %>%
  filter(str_detect(Characteristic, paste(citizenship_status, collapse='|')))

profiles_citizenship

```

```{r profiles-education, echo = F, include = F}
education_status <- c('No certificate, diploma or degree', 'school diploma', 'Postsecondary certificate, diploma or degree')

profiles_education <- profiles_cleaned %>% filter(Topic == 'Highest certificate, diploma or degree') %>%
  filter(str_detect(Characteristic, paste(education_status, collapse='|'))) %>%
  arrange(X_id) %>%
  head(n = 3)

profiles_education

```


```{r profiles-population, echo = F, include = F}
profiles_population <- profiles_cleaned %>% filter(Topic == 'Population and dwellings') %>%
  filter(Characteristic == 'Population, 2016')

profiles_population

```

```{r profiles-minority, echo = F, include = F}
minority <- c('Total visible minority population', 'Not a visible minority')

profiles_minority <- profiles_cleaned %>% filter(Topic == 'Visible minority population') %>%
  filter(str_detect(Characteristic, paste(minority, collapse='|')))

profiles_minority

```

```{r profiles-immigrant, echo = F, include = F}
immigration_status <- c('Non-immigrants', 'Immigrants', 'Non-permanent residents')

profiles_immigrant <- profiles_cleaned %>% filter(Topic == 'Immigrant status and period of immigration') %>%
  filter(str_detect(Characteristic, paste(immigration_status, collapse='|')))

profiles_immigrant


```

```{r profiles-income-tax, echo = F, include = F}
income_tax_status <- c('Income taxes: Average amount')

profiles_income_tax <- profiles_cleaned %>% filter(Topic == 'Income taxes')  %>%
  filter(str_detect(Characteristic, paste(income_tax_status, collapse='|')))


profiles_income_tax


```

```{r profiles-wanted-features, echo = F, include = F}

profiles_wanted_features <- rbind(profiles_age, profiles_education)
# profiles_wanted_features <- rbind(profiles_wanted_features, profiles_citizenship)
profiles_wanted_features <- rbind(profiles_wanted_features, profiles_employment)
profiles_wanted_features <- rbind(profiles_wanted_features, profiles_immigrant)
profiles_wanted_features <- rbind(profiles_wanted_features, profiles_income_tax)
profiles_wanted_features <- rbind(profiles_wanted_features, profiles_minority)
profiles_wanted_features <- rbind(profiles_wanted_features, profiles_population)


profiles_wanted_features_by_neighbourhood <- profiles_wanted_features %>%
  pivot_longer(cols = names(profiles_wanted_features)[5:145], values_to = 'Values', names_to = 'Neighbourhood') %>%
  mutate(across(Neighbourhood, str_replace_all, '\\.', ' ')) # Remove the '.' from the string


profiles2 <- profiles_wanted_features_by_neighbourhood
```


```{r merge-data, echo = F, include = F}

profiles_wanted_features  %>%
  dplyr::select(c(Category, Characteristic, `City.of.Toronto`, Annex)) %>%
  rename("Toronto" = "City.of.Toronto") %>%
  gt() %>%
  tab_header(
    title = 'Variables of Interests from Neighbourhood Profiles (Subset) (2016)',
    subtitle = 'This table only shows the variables for the City of Toronto and one of its neighbourhood, Annex, as a subset example.'
  ) %>%
  tab_style(
    style = cell_borders(
      sides = 'all',
      color = "black",
      weight = px(1.5),
      style = "solid"
    ),
    locations = cells_body(
      columns = everything(),
      rows = everything()
    )
  ) %>%
  opt_stylize(style = 6, color = "cyan") %>%
  tab_options(table.width = pct(100))


```


### 2.2.3 Cleaning of "Airbnb Toronto Data"

The dataset was already cleaned by the maker. However, although the variable is named <code>neighbourhood_cleansed</code>, some neighbourhood names were not standardized. Thus, we manually cleaned the neighbourhood names so that they match with the <Neighbourhood> column in the datasets from the Toronto Data Portal. For example, <code>Mimico (includes Humber Bay Shores)</code> was changed to <code>Mimico</code>.

```{r airbnb-cleaned, echo = F, include = F}
airbnb_cleaned <- airbnb
airbnb_cleaned$neighbourhood_cleansed[airbnb_cleaned$neighbourhood_cleansed == "Mimico (includes Humber Bay Shores)"] <- "Mimico"
airbnb_cleaned$neighbourhood_cleansed[airbnb_cleaned$neighbourhood_cleansed == "L'Amoreaux"] <- "LAmoreaux"
airbnb_cleaned$neighbourhood_cleansed[airbnb_cleaned$neighbourhood_cleansed == "Tam O'Shanter-Sullivan"] <- "Tam OShanter-Sullivan"
airbnb_cleaned$neighbourhood_cleansed[airbnb_cleaned$neighbourhood_cleansed == "O'Connor-Parkview"] <- "OConnor-Parkview"

airbnb_cleaned <- airbnb_cleaned %>%
  mutate(neighbourhood_cleansed = str_replace_all(neighbourhood_cleansed, '[-/\\.]', ' ')) 
```

### 2.2.4 Cleaning of "Toronto Neighbourhood Information"

Similar to the Airbnb dataset, we standardized the neighbourhood names with the existing datasets. We also extracted the <code>number_gyms</code> and <code>number_venues</code> variable columns.

```{r toronto-info-cleaned, echo = F, include = F}
venues_cleaned <- venues
venues_cleaned$Neighborhood[venues_cleaned$Neighborhood == "Mimico (includes Humber Bay Shores)"] <- "Mimico"
venues_cleaned$Neighborhood[venues_cleaned$Neighborhood == "L'Amoreaux"] <- "LAmoreaux"
venues_cleaned$Neighborhood[venues_cleaned$Neighborhood == "Tam O'Shanter-Sullivan"] <- "Tam OShanter-Sullivan"
venues_cleaned$Neighborhood[venues_cleaned$Neighborhood == "O'Connor-Parkview"] <- "OConnor-Parkview" 
venues_cleaned$Neighborhood[venues_cleaned$Neighborhood == "North St. James Town"] <- "North St.James Town"
venues_cleaned$Neighborhood[venues_cleaned$Neighborhood == "Cabbagetown-South St. James Town"] <- "Cabbagetown-South St.James Town"
venues_cleaned$Neighborhood[venues_cleaned$Neighborhood == "Weston-Pelham Park"] <- "Weston-Pellam Park"

venues_cleaned <- venues_cleaned %>%
  select(Neighborhood, number_gyms, number_venues) %>%
  mutate(Neighborhood = str_replace_all(Neighborhood, '[-/\\.]', ' ')) 

colnames(venues_cleaned) <- c('Neighbourhood', 'number_gyms', 'number_venues')
```

## 2.3 Data Exploration

After data cleaning, we performed data exploration on all the datasets, using the <code>ggplot2</code> and <code>leaflet</code> libraries.

### 2.3.1 Distribution of Crime

The plot below shows the number of occurrences of crimes by the five Major Crime Indicator categories in 2016. From the bar plot, assault was the most common crime in 2016, having 18692 occurrences among 33056 cases of offences (56.5%). The next category with highest occurrence was "break and enter", with a count of 6398 times (about one-third of "Assault" cases).

```{r crime-count, echo = F, fig.height=9, fig.width=18}

crimes_cleaned %>%
  ggplot(aes(mci_category, fill=mci_category)) +
  geom_bar(show.legend = F) + 
  labs(
    title = 'Number of Occurrence by Major Crime Indicator Categories in Toronto (2016)',
    x = '\nMajor Crime Indicator Categories\n',
    y = 'Count',
    caption = 'The bar plot shows the distribution of the five Major Crime Indicator categories in Toronto in 2016.\nAssault was the most frequent MCI offence.'
  ) +
  ylim(c(0, 20000)) +
  geom_text(stat='count', aes(label=after_stat(count)), vjust=-1) +
  theme_bw() +
  theme(axis.text=element_text(size=14),
        title = element_text(size=20),
        legend.text = element_text(size=14)
  )

```

The following stacked bar plots show the distribution of crime occurrences and where they occurred. From these plots, there were some interesting observations: 

- "Assault" was the predominant crime in the seven premises type shown below, especially in Transit where it was about seven times more likely to occur than all the other four crimes. This suggested that neighbourhoods with large transit hubs were more likely to suffer from assault offences, or neighbourhoods with a higher population density (hence the need of more transit); 

- Neglecting "Outside", Commercial areas and Apartment buildings have the most MCI offences occurred. This might mean that areas such as downtown area with a high density of commercial properties and apartment buildings have a higher crime count than in relatively suburb areas with more houses.

- Nearly half of the "auto theft" offences occurred outside. This suggested that neighbourhoods with more indoor or underground parking spaces might be less susceptible to auto theft

- The number of crimes occurred in houses were about 80% of that in apartments, but assuming that apartments usually house many more people than a house could, this suggested that the number of offences per person might be higher in houses (which appear in less busy areas) than apartments (which are often in city centers).


```{r crime-count-by-premise, echo = F, fig.height=9, fig.width=18}

crime_by_premise <- crimes_cleaned %>%
  ggplot(aes(x = premises_type, fill = mci_category)) +
  geom_bar() + 
  coord_flip() + 
  labs(
    title = 'Number of Occurrence\nby Major Crime Indicator Categories\nby Premise Type in Toronto (2016)\n',
    x = '\nPremise Type\n',
    y = '\nCount\n',
    caption = 'The stacked bar plot shows the\ndistribution of the five Major Crime Indicator categories\nby premise type in Toronto in 2016.\nCommerical areas and Apartment buildings are all\ntargets of offences.',
    fill = 'MCI Category'
  ) +
  theme(axis.text=element_text(size=14),
        title = element_text(size=20),
        legend.text = element_text(size=14)
  )

crime_by_category <- crimes_cleaned %>%
  ggplot(aes(fill = premises_type, x = mci_category)) +
  geom_bar() + 
  coord_flip() + 
  labs(
    title = 'Premise of Occurrence\nby Crime Indicator Categories\nin Toronto (2016)\n',
    x = '\nMajor Crime Indicator Categories\n',
    y = '\nCount\n',
    caption = 'The stacked bar plot shows the distribution of premise of occurence\nby the five Major Crime Indicator categories in Toronto in 2016.\nRobbery and Autotheft mainly occurred outside, while\nBreak and Enter mostly occurred in Houses and Commercial areas.',
    fill = 'Premises Type'
  ) +
  theme(axis.text=element_text(size=14),
        title = element_text(size=20),
        legend.text = element_text(size=14)
  )

plot_grid(crime_by_premise, crime_by_category, ncol=2)
```

We also inspected the trend of offence occurrences with respect to time in 2016 with the histogram below. The trend shown in the plot suggests that there were no significant relationship between the day of year and the number of major crime occurred, as the plot appears to be close to a uniform distribution with only minor fluctuations periodically, with the exception of Day 1: the spike of assault cases on the first day of the year was interesting yet concerning. This spike does not seem to be from a data collection error, as the dataset had valid information on all the those cases on that day. This number might be related to new years celebration where people usually got drunk and high during celebration events and festivals, hence the increase in assault offences.

```{r crime-by-time, echo = F, fig.height=9, fig.width=18}


crimes_cleaned %>%
  ggplot(aes(x = occurrencedayofyear, fill = mci_category)) +
  geom_histogram(binwidth = 2) + 
  labs(
    title = 'Number of Occurrence by Major Crime Indicator Categories\nby Day of Year in Toronto (2016)\n',
    x = '\nDay of Year\n',
    y = '\nCount\n',
    caption = 'The stacked bar plot shows the distribution of the five Major Crime Indicator categories by day of year in Toronto in 2016.\nA large amount of assault offences were found on New Years Day.',
    fill = 'MCI Category'
  ) +
  theme(axis.text=element_text(size=14),
        title = element_text(size=20),
        legend.text = element_text(size=14)
  )

```


The following barplot shows the Top 10 Neighbourhoods sorted by the number of major crime occurrences in 2016 in descending order. The results did not come as surprising, as the neighbourhood with the most population (Waterfront Communities Population: 65913) had the highest crime occurrences. Busy city centres were also in the plot (Bay Street, Church-Yonge). Interestingly, West Humber Clairville had significantly more auto theft offences compared to the other neighbourhoods, which was 80% of all the other 9 neighbourhoods combined (318 vs 385).

```{r crimes_cleaned_by_mci, echo = F, include = F}

crimes_by_neighbourhood %>%
  head(n = 10) %>%
  gt() %>%
  tab_header(
    title = 'Top 10 Neighbourhoods by Total MCI Offence Occurrences (2016)'
  ) %>%
  tab_style(
    style = cell_borders(
      sides = 'all',
      color = "black",
      weight = px(1.5),
      style = "solid"
    ),
    locations = cells_body(
      columns = everything(),
      rows = everything()
    )
  ) %>%
  opt_stylize(style = 6, color = "cyan")
```


```{r crime-by-neighbourhood, echo = F, fig.height=9, fig.width=18}
crimes_by_neighbourhood %>%
  arrange(desc(Total)) %>%
  head(n = 10) %>%
  gather('offence', 'count', -c(Hood_ID, Neighbourhood, Total)) %>%
  ggplot(aes(x = reorder(Neighbourhood, Total), y = count, group = offence, fill = offence)) +
  geom_bar(stat='identity') + 
  coord_flip() + 
  labs(
    title = 'Top 10 Neighbourhoods by Number of Occurrence of Major Crimes\nin Toronto (2016)\n',
    x = '\nNeighbourhood\n',
    y = '\nCount\n',
    fill = 'Offence',
    caption = 'Neighbourhood with high population and busy city centers all had high MCI offence counts.'
  ) +
  theme(axis.text=element_text(size=14),
        title = element_text(size=20),
        legend.text = element_text(size=14)
  )
  

```

### 2.3.2 Airbnb Listings and MCI Offences

To investigate whether there was a correlation between the number of Airbnb listings and MCI offences, a scatterplot with a best-fitted line was created. The plot suggests that there is a moderate positive relationship between these two numbers. However, the variance of number of offences is much higher when the number of listings are high, which suggests that Airbnb listing was only one of the factors which affected the number of MCI offences. 

Note that Waterfront Communities-The Island with 2754 listings and 1241 offences was omitted in the plot for aesthetic purposes. 

```{r airbnb_count, echo = F, message = F, warning=F, fig.height=9, fig.width=18}
airbnb_count <- airbnb_cleaned %>%
  group_by(neighbourhood_cleansed) %>%
  dplyr::summarise(count = n()) 

colnames(airbnb_count) <- c('Neighbourhood', 'Airbnb')


  
crimes_cleaned_count <- crimes_cleaned %>%
  group_by(Neighbourhood) %>%
  dplyr::summarise(count = n())

airbnb_vs_crimes <- merge(
  x = airbnb_count,
  y = crimes_cleaned_count,
  all.x = T,
  all.y = T,
  by.x = 'Neighbourhood',
  by.y = 'Neighbourhood'
)
colnames(airbnb_vs_crimes) <- c('Neighbourhood', 'Airbnb', 'Crime')

airbnb_vs_crimes %>%
  ggplot(aes(x = Airbnb, y = Crime)) +
  geom_point() + 
  geom_smooth(method='lm') + 
  xlim(0, 650) +
  labs(
    title = 'Number of Airbnb Listings vs Number of Crime Offences by Neighbourhood in Toronto (2016)\n',
    x = 'Number of Airbnb Listings',
    y = 'Number of Crime Offences',
    caption = 'The scatterplot shows how the number of airbnb listings affect the number of crime offences.\nThe plot suggests there is a positive correlation between these two numbers.\nNote that Waterfront Communities-The Island with 2754 listings and 1241 offences were omitted for aesthetic purposes.'
  ) +
  theme(axis.text=element_text(size=14),
        title = element_text(size=20),
        legend.text = element_text(size=14)
  )
```


### 2.3.3 Venues (POIs), Gyms, and MCI Offences


Next, we investigated if the number of MCI offences were related to the number of venues (POIs) and gyms by plotting a scatterplot with a best-fitted line. There is only a very weak positive relationship between these two factors, if not none at all. However, the plot shows that some outliers with high number of MCI offences occurred in neighbourhoods with the highest venues and gyms.


```{r venues_count, echo = F, message = F, warning=F, fig.height=9, fig.width=18}
venues_vs_crimes <- merge(
  x = venues_cleaned,
  y = crimes_cleaned_count,
  all.x = T,
  all.y = T,
  by.x = 'Neighbourhood',
  by.y = 'Neighbourhood'
)
colnames(venues_vs_crimes) <- c('Neighbourhood', 'Gyms', 'Venues', 'Crime')
venues_vs_crimes$Places <- venues_vs_crimes$Gyms + venues_vs_crimes$Venues

venues_vs_crimes %>%
  ggplot(aes(x = Places, y = Crime)) +
  geom_point() + 
  geom_smooth(method='lm') + 
  labs(
    title = 'Number of POIs and Gyms vs Number of Crime Offences by Neighbourhood in Toronto (2016)\n',
    x = 'Number of Points of Interests and Gyms',
    y = 'Number of Crime Offences',
    caption = 'The scatterplot shows how the number of POIs and gyms affect the number of crime offences.\nThe plot suggests there is a very weak correlation between these two numbers, if not none at all.'
  ) +
  theme(axis.text=element_text(size=14),
        title = element_text(size=20),
        legend.text = element_text(size=14)
  )
```


### 2.3.4 Neighbourhood Demographics and Crime Rate

We inspected the relationship between the crime rate and the variables of interests, i.e. population size, population age, education, employment/labour, immigration and citizenship status, income taxes, and the level of visible minority. For each variable, we used the extracted sub-tables with only relevant fields created in the "Data Cleaning" section. For each sub-table, we merged it with two other tables, one containing (Neighbourhood, Population) tuples, and one containing the number of reported crime per offence type.


#### 2.3.4.1 Relationship between Population Size and Crime Rate

It is not surprising that the best fitted lines shows that the number of offences increased with the number of population in a neighbourhood. However, in all the subplots, the majority of the neighbourhoods had a population of less than 30 thousand, and there are outliers and influential points in the plots. A better indicator of crime rate versus population might be plotting the crime rate against the population density instead, which is more representative of the scale of crime rate in terms of neighbourhood size: a neighbourhood with higher population density is more likely to have higher crime rate.

```{r crime-vs-population, echo = F, include = F}
profiles_population_rel <- profiles_population %>%
  t() %>%
  as.data.frame() %>%
  setNames(as.vector(.[4, ])) %>%
  filter(!row_number() %in% c(1:5)) %>%
  rownames_to_column(var = 'Neighbourhood') %>%
  mutate(across(Neighbourhood, str_replace_all, '\\.', ' ')) %>%
  mutate_at(-c(1), as.numeric)

crime_vs_population <- merge(
  x = profiles_population_rel,
  y = crimes_by_neighbourhood ,
  all.x = T,
  all.y = T,
  by.x = 'Neighbourhood',
  by.y = 'Neighbourhood'
) %>%
  mutate_at(c(2:9), remove_commas) %>%
  pivot_longer(cols = c(4:9), values_to = 'Count', names_to = 'Offence') 
```

```{r crime-vs-population-2, echo = F, fig.width = 18, fig.height = 9, warning=F, message=F}
crime_vs_population %>%
  ggplot(aes(x = `Population, 2016`, y = Count, color=Offence)) +
  geom_point() +
  geom_smooth(method = 'lm', se=F, color='black') + 
  facet_wrap(~Offence, scales = 'free') + 
  labs(
    title = 'Relationship between Neighbourhood Population and Number of MCI Offence Occurrence (Toronto 2016)',
    x = '\nPopulation\n',
    y = '\nCount\n'
  ) +
  theme(axis.text=element_text(size=14),
        title = element_text(size=20),
        legend.text = element_text(size=14),
        strip.text.x = element_text(size = 18)
  )


```



#### 2.3.4.2 Relationship between Population Age and Crime Rate

We fitted a basic linear model where the response variable was the number of offences and the variables were the proportion of different age groups in the neighbourhood. Note that in the original dataset, there were two additional age groups (<code>Seniors (65+ years)</code> and <code>Older Seniors (85+ years)</code>). However, we did not include them in this preliminary model as it would induce multicollinearity, since these proportions of age groups add up to 1. 

From the p-values below, we can see that the proportion of age groups are all statistically significant. Based on the signs of the estimated coefficients, they confirm from our previous findings that a neighbourhood with larger proportion of senior residents are likely to have fewer crime rate (negative coefficient), while increasing number of youths (positive coefficient) is more likely to the crime rate^[Ulmer, J. T., & Steffensmeier, D. (2014). The age and crime relationship: Social variation, social explanations. In The Nurture Versus Biosocial Debate in Criminology: On the Origins of Criminal Behavior and Criminality (pp. 377-396). SAGE Publications Inc.. https://doi.org/10.4135/9781483349114.n23].

However, the estimated coefficient for the intercept is much larger than the estimated coefficient for the age groups, thus any change in the percentages of age groups would only change the estimated crime rate slightly. This strongly suggested that there were other factors which affect crime rate, and the p-values show that age group is one of the significant factors. 

```{r crime-vs-age, echo = F, include = F}

profiles_age_rel <- profiles_age %>%
  t() %>%
  as.data.frame() %>%
  setNames(as.vector(.[4, ])) %>%
  filter(!row_number() %in% c(1:5)) %>%
  rownames_to_column(var = 'Neighbourhood') %>%
  mutate(across(Neighbourhood, str_replace_all, '\\.', ' ')) 


  

crime_vs_age <- merge(
  x = profiles_age_rel,
  y = crimes_by_neighbourhood ,
  all.x = T,
  all.y = T,
  by.x = 'Neighbourhood',
  by.y = 'Neighbourhood'
) %>%
  mutate_at(c(2:10), remove_commas)
```



```{r crime-vs-age-lm, fig.width = 18, fig.height=9, echo = F}
crime_vs_age_lm_table <- crime_vs_age[, c(2:5, 14)]
lm_age <- lm(data = crime_vs_age_lm_table, formula = Total ~ .)

lm_age %>%
  tidy() %>%
  kable(
    caption = 'Coefficient Estimates of a Linear Regression Model for Estimating MCI Offence Count (Age Groups)',
    col.names = c('Terms', 'Estimate', 'Std. Error', 't-value', 'p-value'),
    digits = 3
  )

# aov_age_summary_df <- data.frame(unclass(summary(aov_age)), check.names = F, stringsAsFactors = F) %>% 
#   mutate_if(is.numeric, round, 3) %>% 
#   rownames_to_column(var = 'Factors') %>%
#   mutate(Factors = str_replace_all(Factors, '`', '')) 


```


#### 2.3.4.3 Relationship between Education and Crime Rate

We also fitted a basic linear model where the response variable is the number of MCI offences and the predictors are the proprtion of people with different levels of education. The baseline of education is "No certificate, diploma or degree". From the summary, we can see that an increase proportion of people with secondary and postsecondary education increases the number of crime rates, but the increase is around 3 times as big for an increase in proportion of people with only secondary education than those with postsecondary education. 

Similar to the estimated coefficients for age groups, the estimated coefficient for the intercept (-581) is negative and the estimated coefficients for the factors were positive and much larger (708 and 2299). This strongly suggested that we should also look at other factors at the same time. The p-values suggest that education is a significant factor on crime rate alone, so it might be useful to combine education with other variables and check if the combinations affect crime rate altogether.

```{r crime-vs-education, echo=F}

profiles_edu_rel <- profiles_education %>%
  t() %>%
  as.data.frame() %>%
  setNames(as.vector(.[4, ])) %>%
  filter(!row_number() %in% c(1:5)) %>%
  rownames_to_column(var = 'Neighbourhood') %>%
  mutate(across(Neighbourhood, str_replace_all, '\\.', ' '))

crime_vs_education <- merge(
  x = profiles_edu_rel,
  y = crimes_by_neighbourhood ,
  all.x = T,
  all.y = T,
  by.x = 'Neighbourhood',
  by.y = 'Neighbourhood'
) 

crime_vs_education <- merge(
  x = profiles_population_rel,
  y = crime_vs_education ,
  all.x = T,
  all.y = T,
  by.x = 'Neighbourhood',
  by.y = 'Neighbourhood'
) 

crime_vs_education <- crime_vs_education %>%
  mutate_at(c(2:5), as.numeric) %>%
  mutate_at(c(3:5), ~ .x/`Population, 2016`)
```


```{r crime-vs-education-lm, echo=F}
crime_vs_edu_lm_table <- crime_vs_education[, c(3,5, 12)]
lm_edu <- lm(data = crime_vs_edu_lm_table, formula = Total ~ .)

lm_edu %>%
  tidy() %>%
  kable(
    caption = 'Coefficient Estimates of a Linear Regression Model for Estimating MCI Offence Count (Education)',
    col.names = c('Terms', 'Estimate', 'Std. Error', 't-value', 'p-value'),
    digits = 3
  )
```


#### 2.3.4.4 Relationship between Employment and Crime Rate

The fitted linear model below shows that the effect of the number of people who did not work in a neighbourhood on crime rate was statistically significant. This result aligned with the common consensus that unemployment rate was positively correlated with crime rate (Farrington et al. 1986^[Farrington, D. P., Gallagher, B., Morley, L., St. Ledger, R. J., & West, D. J. (1986). UNEMPLOYMENT, SCHOOL LEAVING, AND CRIME. The British Journal of Criminology, 26(4), 335–356. http://www.jstor.org/stable/23637076], John Howard Society of Ontario 2009^[https://johnhoward.on.ca/wp-content/uploads/2014/09/facts-24-crime-and-unemployment-whats-the-link-march-2009.pdf]).

```{r crime-vs-employment, echo = F}
profiles_employment_rel <- profiles_employment %>%
  t() %>%
  as.data.frame() %>%
  setNames(as.vector(.[4, ])) %>%
  filter(!row_number() %in% c(1:5)) %>%
  rownames_to_column(var = 'Neighbourhood') %>%
  mutate(across(Neighbourhood, str_replace_all, '\\.', ' ')) %>%
  mutate_at(-c(1), as.numeric)


crime_vs_employment <- merge(
  x = profiles_employment_rel,
  y = crimes_by_neighbourhood ,
  all.x = T,
  all.y = T,
  by.x = 'Neighbourhood',
  by.y = 'Neighbourhood'
) 

crime_vs_employment <- merge(
  x = profiles_population_rel,
  y = crime_vs_employment ,
  all.x = T,
  all.y = T,
  by.x = 'Neighbourhood',
  by.y = 'Neighbourhood'
) 
```


```{r crime-vs-employment-lm, echo = F}

crime_vs_employment_lm_table <- crime_vs_employment[, c(3, 12)]
lm_employment <- lm(data = crime_vs_employment_lm_table, formula = Total ~ .)

lm_employment %>%
  tidy() %>%
  kable(
    caption = 'Coefficient Estimates of a Linear Regression Model for Estimating MCI Offence Count (Employment Status)',
    col.names = c('Terms', 'Estimate', 'Std. Error', 't-value', 'p-value'),
    digits = 3
  )


```



#### 2.3.4.5 Relationship between Immigration and Citizenship Status and Crime Rate

We plotted the number of MCI offences against the proprtion of immigrants in the 140 neighbourhoods, separated by offence type and also included a total count. From these plots, we can see that as the proportion of immigrants increased in a neighbourhood, the number of crimes committed decreases, with the exception of "Break and Enter" which stayed roughly the same. This aligned with our prior findings which concluded that the number of immigrants (statistically-)significantly reduced the number of crimes in the area^[Statistics Canada. (n.d.). Main article. Neighbourhood Characteristics and the Distribution of Police-reported Crime in the City of Toronto. Retrieved March 13, 2023, from https://www150.statcan.gc.ca/n1/pub/85-561-m/2009018/part-partie1-eng.htm]. 

```{r crime-vs-immgiration, echo = F}
profiles_immigrant_rel <- profiles_immigrant %>%
  t() %>%
  as.data.frame() %>%
  setNames(as.vector(.[4, ])) %>%
  filter(!row_number() %in% c(1:5)) %>%
  rownames_to_column(var = 'Neighbourhood') %>%
  mutate(across(Neighbourhood, str_replace_all, '\\.', ' ')) %>%
  mutate_at(-c(1), as.numeric)

crime_vs_immigrant <- merge(
  x = profiles_immigrant_rel,
  y = crimes_by_neighbourhood ,
  all.x = T,
  all.y = T,
  by.x = 'Neighbourhood',
  by.y = 'Neighbourhood'
) 

crime_vs_immigrant <- merge(
  x = profiles_population_rel,
  y = crime_vs_immigrant ,
  all.x = T,
  all.y = T,
  by.x = 'Neighbourhood',
  by.y = 'Neighbourhood'
) 

crime_vs_immigrant <- crime_vs_immigrant %>%
  mutate_at(-c(1), as.numeric)


crime_vs_immigrant <- crime_vs_immigrant %>%
  mutate("Immigration_Rate" = .[[3]]/`Population, 2016`)
```

```{r crime-vs-immigration-lm, echo = F, message = F, warning=F, fig.width=18, fig.height=9}


crime_vs_immigrant_lm_table <- crime_vs_immigrant[, c(12, 13)]
lm_immigrant <- lm(data = crime_vs_immigrant_lm_table, formula = Total ~ .)

lm_immigrant %>%
  tidy() %>%
  kable(
    caption = 'Coefficient Estimates of a Linear Regression Model for Estimating MCI Offence Count (Employment Status)',
    col.names = c('Terms', 'Estimate', 'Std. Error', 't-value', 'p-value'),
    digits = 3
  )

crime_vs_immigrant %>%
  pivot_longer(cols = c(7:12), values_to = 'Count', names_to = 'Offence') %>%
  ggplot(aes(x = `Immigration_Rate`, y = Count, color=Offence)) +
  geom_point() +
  geom_smooth(method = 'lm', se=F, color='black') + 
  facet_wrap(~Offence, scales = 'free') + 
  labs(
    title = 'Relationship between Neighbourhood Population and Number of MCI Offence Occurrence (Toronto 2016)',
    x = '\nPopulation\n',
    y = '\nCount\n'
  ) +
  theme(axis.text=element_text(size=14),
        title = element_text(size=20),
        legend.text = element_text(size=14),
        strip.text.x = element_text(size = 18)
  )
```



#### 2.3.4.6 Relationship between Visible Minority and Crime Rate

A racially-diversed neighbourhood were found to be linked to lower crime rate, especially in rural areas^[Kim, Y.-A., &amp; Wo, J. C. (2022, April 1). Racially diverse neighborhoods in diverse areas are linked to lower crime rates. Racially diverse neighborhoods in diverse areas are linked to lower crime rates Comments. Retrieved March 13, 2023, from https://blogs.lse.ac.uk/usappblog/2022/04/01/racially-diverse-neighborhoods-in-diverse-areas-are-linked-to-lower-crime-rates/ ]. Hence, we chose to explore the relationship of neighbourhood crime rate and the proportion of visible minority because we believed that this feature was also related to immigration and citizenship status, which was found to be correlated with crime rate^[Statistics Canada. (n.d.). Main article. Neighbourhood Characteristics and the Distribution of Police-reported Crime in the City of Toronto. Retrieved March 13, 2023, from https://www150.statcan.gc.ca/n1/pub/85-561-m/2009018/part-partie1-eng.htm]. However, unlike the number of immigrants, we could see that crime rates were likely to be weakly positively correlated with the proportion of visible minority in the neighbourhood from the plots. The number of outliers in the plots might suggest why we obtained a different result than expected.

```{r crime-vs-minority, echo = F}
profiles_minority_rel <- profiles_minority %>%
  t() %>%
  as.data.frame() %>%
  setNames(as.vector(.[4, ])) %>%
  filter(!row_number() %in% c(1:5)) %>%
  rownames_to_column(var = 'Neighbourhood') %>%
  mutate(across(Neighbourhood, str_replace_all, '\\.', ' ')) %>%
  mutate_at(-c(1), as.numeric)

crime_vs_minority <- merge(
  x = profiles_minority_rel,
  y = crimes_by_neighbourhood ,
  all.x = T,
  all.y = T,
  by.x = 'Neighbourhood',
  by.y = 'Neighbourhood'
) 

crime_vs_minority <- merge(
  x = profiles_population_rel,
  y = crime_vs_minority ,
  all.x = T,
  all.y = T,
  by.x = 'Neighbourhood',
  by.y = 'Neighbourhood'
) 

crime_vs_minority <- crime_vs_minority %>%
  mutate_at(c(2:11), as.numeric) %>%
  mutate('Minority_Ratio' = .[[3]]/`Population, 2016`)
```

```{r crime-vs-minority-plot, echo = F, fig.width = 18, fig.height = 9, warning=F, message=F}
crime_vs_minority %>%
  pivot_longer(cols = 6:11, names_to = 'Offence', values_to = 'Count') %>%
  ggplot(aes(x = Minority_Ratio, y = Count, color=Offence)) +
  geom_point() +
  geom_smooth(method = 'lm', se=F, color='black') + 
  facet_wrap(~Offence, scales = 'free') + 
  labs(
    title = 'Relationship between Neighbourhood Visible Minority Proportion\nand Number of MCI Offence Occurrence (Toronto 2016)',
    x = '\nVisible Minority Proportion\n',
    y = '\nCount\n'
  ) +
  theme(axis.text=element_text(size=14),
        title = element_text(size=20),
        legend.text = element_text(size=14),
        strip.text.x = element_text(size = 18)
  )
```


#### 2.3.4.7 Relationship between Income and Crime Rate

To estimate the effect of average individual income on a neighbourhood's crime rate, we plotted the number of offences against average income tax per offence type. The data for income groups were discovered to be corrupted during data cleaning (see Section 2.2.2). Thus, we used the average income tax as an indicator of household income level for each neighbourhood. In the subplots, the numbers of all offence types decrease as the average income taxes of the neighbourhood increase, with the exception of "Break and Enter". This might be explained by the fact that wealthy neighbourhoods were more likely to have better security, and relative risk associated with theft in wealthy neighbourhoods outweighted the possibility of stealing more expensive goods, thus deterring thefts^[Chamberlain, A. W., &amp; Boggess, L. N. (2016, September 26). Why disadvantaged neighborhoods are more attractive targets for burgling than wealthy ones. Why disadvantaged neighborhoods are more attractive targets for burgling than wealthy ones Comments. Retrieved March 13, 2023, from https://blogs.lse.ac.uk/usappblog/2016/09/26/why-disadvantaged-neighborhoods-are-more-attractive-targets-for-burgling-than-wealthy-ones/].

```{r crime-vs-income, echo = F}
profiles_income_rel <- profiles_income_tax %>%
  t() %>%
  as.data.frame() %>%
  setNames(as.vector(.[4, ])) %>%
  filter(!row_number() %in% c(1:5)) %>%
  rownames_to_column(var = 'Neighbourhood') %>%
  mutate(across(Neighbourhood, str_replace_all, '\\.', ' ')) %>%
  mutate_at(-c(1), as.numeric)


crime_vs_income <- merge(
  x = profiles_income_rel,
  y = crimes_by_neighbourhood ,
  all.x = T,
  all.y = T,
  by.x = 'Neighbourhood',
  by.y = 'Neighbourhood'
) 
```

```{r crime-vs-income-plot, echo = F, fig.width = 18, fig.height = 9, warning=F, message=F}
crime_vs_income %>%
  pivot_longer(cols = 4:9, names_to = 'Offence', values_to = 'Count') %>%
  ggplot(aes(x = .[[2]], y = Count, color = Offence)) +
  geom_point() +
  geom_smooth(method = 'lm', se=F, color='black') + 
  facet_wrap(~Offence, scales = 'free') + 
  labs(
    title = 'Relationship between Neighbourhood Average Income (by Average Income Tax)\nand Number of MCI Offence Occurrence (Toronto 2016)',
    x = '\nIncome (Average Income Tax)\n',
    y = '\nCount\n'
  ) +
  theme(axis.text=element_text(size=14),
        title = element_text(size=20),
        legend.text = element_text(size=14),
        strip.text.x = element_text(size = 18)
  )
```



## 2.4 Modelling


```{r everything, echo = F, include = F}
VOI <- c('airbnb_count', 'venues_cleaned',  # new data
                'profiles_age_rel', 'profiles_edu_rel', 'profiles_employment_rel', 'profiles_immigrant_rel',
                'profiles_income_rel', 'profiles_minority_rel', 'profiles_population_rel')

everything <- crimes_by_neighbourhood
for (d in VOI){
  everything <- merge(
    x = everything,
    y = get(d),
    all.x = T,
    all.y = T,
    by.x = 'Neighbourhood',
    by.y = 'Neighbourhood'
  )
  
}

```

# 3. Results

# 4. Conclusions and Summary

# 5. Limitations

# 6. Next Steps

# 7. References

1. Foster, S., Giles-Corti, B., & Knuiman, M. (2010). Neighbourhood design and fear of crime: A social-ecological examination of the correlates of residents’ fear in new suburban housing developments. In Health & Place (Vol. 16, Issue 6, pp. 1156–1165). Elsevier BV. https://doi.org/10.1016/j.healthplace.2010.07.007

2. Statistics Canada. (2021). Neighbourhood characteristics and life satisfaction of individuals in lower-, middle-, and higher-income families in Canadian metropolitan areas. Government of Canada. https://doi.org/10.25318/36280001202100500006-ENG

3. Government of Canada, S. C. (2020, July 17). Census of population. Surveys and statistical programs. Retrieved March 13, 2023, from https://www23.statcan.gc.ca/imdb/p2SV.pl?Function=getSurvey&SDDS=3901

4. Statistics Canada. (n.d.). Main article. Neighbourhood Characteristics and the Distribution of Police-reported Crime in the City of Toronto. Retrieved March 13, 2023, from https://www150.statcan.gc.ca/n1/pub/85-561-m/2009018/part-partie1-eng.htm

5. Sun, Ivan Y.; Triplett, Ruth A.; and Gainey, Randy R., “Neighborhood Characteristics and Crime: A Test of Sampson and Groves’ Model of Social Disorganization” (2004). Sociology & Criminal Justice Faculty Publications. 3. https://digitalcommons.odu.edu/sociology_criminaljustice_fac_pubs/3

6. Ulmer, J. T., & Steffensmeier, D. (2014). The age and crime relationship: Social variation, social explanations. In The Nurture Versus Biosocial Debate in Criminology: On the Origins of Criminal Behavior and Criminality (pp. 377-396). SAGE Publications Inc.. https://doi.org/10.4135/9781483349114.n23

7. Farrington, D. P., Gallagher, B., Morley, L., St. Ledger, R. J., & West, D. J. (1986). UNEMPLOYMENT, SCHOOL LEAVING, AND CRIME. The British Journal of Criminology, 26(4), 335–356. http://www.jstor.org/stable/23637076

8. Kim, Y.-A., & Wo, J. C. (2022, April 1). Racially diverse neighborhoods in diverse areas are linked to lower crime rates. Racially diverse neighborhoods in diverse areas are linked to lower crime rates Comments. Retrieved March 13, 2023, from https://blogs.lse.ac.uk/usappblog/2022/04/01/racially-diverse-neighborhoods-in-diverse-areas-are-linked-to-lower-crime-rates/

9. Chamberlain, A. W., & Boggess, L. N. (2016, September 26). Why disadvantaged neighborhoods are more attractive targets for burgling than wealthy ones. Why disadvantaged neighborhoods are more attractive targets for burgling than wealthy ones Comments. Retrieved March 13, 2023, from https://blogs.lse.ac.uk/usappblog/2016/09/26/why-disadvantaged-neighborhoods-are-more-attractive-targets-for-burgling-than-wealthy-ones/

10. Twinam, T. (2017, May 25). Danger zone: Land use and the geography of neighborhood crime. Retrieved April 25, 2023, from https://www.sciencedirect.com/science/article/abs/pii/S009411901730044X?dgcid=raven_sd_aip_email

11. Ke, L., O’Brien, D. T., & Heydari, B. (2021, July 14). Airbnb and neighborhood crime: The incursion of tourists or the erosion of local social dynamics? PLOS ONE. Retrieved April 25, 2023, from https://journals.plos.org/plosone/article?id=10.1371%2Fjournal.pone.0253315

# 8. Appendix

## Table 1. Sample of Dataset - Major Crime Indicators 


```{r data-intro-crimes, echo = F}
crimes %>%
  head(n = 4) %>%
  gt() %>%
  tab_header(
    title = 'Major Crime Indicators',
    subtitle = 'Occurrence of Crime from January 2014 to June 2022'
  ) %>%
  tab_style(
    style = cell_borders(
      sides = 'all',
      color = "black",
      weight = px(1.5),
      style = "solid"
    ),
    locations = cells_body(
      columns = everything(),
      rows = everything()
    )
  ) %>%
  opt_stylize(style = 6, color = "cyan")
```

## Table 2. Sample of Dataset - Neighbourhood Profiles (Census)


```{r data-intro-profiles, echo = F}
profiles %>%
  head(n = 4) %>%
  gt() %>%
  tab_header(
    title = 'Neighbourhood Profiles',
    subtitle = 'Census of Neighbourhoods in 2016'
  ) %>%
  tab_style(
    style = cell_borders(
      sides = 'all',
      color = "black",
      weight = px(1.5),
      style = "solid"
    ),
    locations = cells_body(
      columns = everything(),
      rows = everything()
    )
  ) %>%
  opt_stylize(style = 6, color = "cyan")
```

## Table 3. Sample of Dataset - Airbnb Toronto Data

```{r data-intro-airbnb, echo = F}
airbnb %>%
  head(n = 4) %>%
  gt() %>%
  tab_header(
    title = 'Airbnb Toronto Data',
    subtitle = 'Airbnb Listings in Toronto 2016'
  ) %>%
  tab_style(
    style = cell_borders(
      sides = 'all',
      color = "black",
      weight = px(1.5),
      style = "solid"
    ),
    locations = cells_body(
      columns = everything(),
      rows = everything()
    )
  ) %>%
  opt_stylize(style = 6, color = "cyan")
```


## Table 4. Sample of Dataset - Toronto Neighbourhoods Information

```{r data-intro-neigh-info, echo = F}
venues %>%
  head(n = 4) %>%
  gt() %>%
  tab_header(
    title = 'Toronto Neighbourhoods Information'
  ) %>%
  tab_style(
    style = cell_borders(
      sides = 'all',
      color = "black",
      weight = px(1.5),
      style = "solid"
    ),
    locations = cells_body(
      columns = everything(),
      rows = everything()
    )
  ) %>%
  opt_stylize(style = 6, color = "cyan")
```


## Table 5. Sample of Cleaned Dataset - Major Crime Indicators


```{r crimes-cleaned-sample, echo = F, fig.width=15}
crimes_cleaned %>%
  head(n = 4) %>%
  gt() %>%
  tab_header(
    title = 'Major Crime Indicators (2016)',
    subtitle = 'Occurrence of Crime in 2016'
  ) %>%
  tab_style(
    style = cell_borders(
      sides = 'all',
      color = "black",
      weight = px(1.5),
      style = "solid"
    ),
    locations = cells_body(
      columns = everything(),
      rows = everything()
    )
  ) %>%
  opt_stylize(style = 6, color = "cyan")
```

## Table 6. Sample of Cleaned Dataset - Airbnb Toronto Data


```{r airbnb-cleaned-sample, echo = F, fig.width=15}
airbnb_cleaned %>%
  head(n = 4) %>%
  gt() %>%
  tab_header(
    title = 'Airbnb Toronto Data'
  ) %>%
  tab_style(
    style = cell_borders(
      sides = 'all',
      color = "black",
      weight = px(1.5),
      style = "solid"
    ),
    locations = cells_body(
      columns = everything(),
      rows = everything()
    )
  ) %>%
  opt_stylize(style = 6, color = "cyan")
```


## Table 7. Sample of Cleaned Dataset - Toronto Neighbourhoods Information


```{r venues-cleaned, echo = F, fig.width=15}
venues_cleaned %>%
  head(n = 8) %>%
  gt() %>%
  tab_header(
    title = 'Airbnb Toronto Data'
  ) %>%
  tab_style(
    style = cell_borders(
      sides = 'all',
      color = "black",
      weight = px(1.5),
      style = "solid"
    ),
    locations = cells_body(
      columns = everything(),
      rows = everything()
    )
  ) %>%
  opt_stylize(style = 6, color = "cyan")
```